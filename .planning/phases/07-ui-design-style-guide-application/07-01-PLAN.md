---
phase: 07-ui-design-style-guide
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/config/themes.ts
  - frontend/src/contexts/ThemeContext.tsx
  - frontend/src/index.css
  - backend/src/collections/Events.ts
  - frontend/src/lib/api.ts
autonomous: true

must_haves:
  truths:
    - "generateTheme() derives full 10-token palette from a single accent hex"
    - "4 built-in palettes are defined (Tech Modern, Vibrant Purple, Nature Teal, Energy Orange)"
    - "WCAG AA contrast validation rejects insufficient contrast ratios"
    - "ThemeProvider injects CSS custom properties into wrapper element"
    - "Backend Events collection stores theme selection per event"
    - "Inter font loads and applies to public pages"
  artifacts:
    - path: "frontend/src/config/themes.ts"
      provides: "Theme definitions, generateTheme(), contrast validation, BUILT_IN_THEMES map"
      exports: ["generateTheme", "BUILT_IN_THEMES", "DEFAULT_THEME_ID", "ThemeDefinition", "ThemeVars"]
    - path: "frontend/src/contexts/ThemeContext.tsx"
      provides: "ThemeProvider component and useTheme hook"
      exports: ["ThemeProvider", "useTheme"]
    - path: "backend/src/collections/Events.ts"
      provides: "theme JSON field on Events collection"
      contains: "theme"
    - path: "frontend/src/index.css"
      provides: "CSS custom property references + Inter font import"
      contains: "--bg"
  key_links:
    - from: "frontend/src/contexts/ThemeContext.tsx"
      to: "frontend/src/config/themes.ts"
      via: "imports generateTheme and BUILT_IN_THEMES"
      pattern: "import.*from.*config/themes"
    - from: "frontend/src/contexts/ThemeContext.tsx"
      to: "DOM style attribute"
      via: "sets CSS custom properties on wrapper div"
      pattern: "style.*--bg|--accent"
    - from: "frontend/src/lib/api.ts"
      to: "backend Events.theme field"
      via: "fetchAttendanceDay returns event.theme"
      pattern: "theme"
---

<objective>
Theme infrastructure: generateTheme algorithm, 4 built-in palettes, ThemeProvider context, backend theme field, Inter font, and CSS custom property foundation.

Purpose: Establish the complete theming foundation that public pages and organizer UI will consume. All downstream plans depend on these artifacts existing.
Output: Working theme system that can generate palettes from any accent color and inject them as CSS variables.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.claude/documentation/design-sytem-description.md
@frontend/src/index.css
@frontend/src/App.tsx
@frontend/package.json
@backend/src/collections/Events.ts
@frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Theme config with generateTheme algorithm and 4 built-in palettes</name>
  <files>frontend/src/config/themes.ts</files>
  <action>
Create `frontend/src/config/themes.ts` containing:

1. **Type definitions:**
   - `ThemeVars`: object with 10 CSS custom property keys (`--bg`, `--surface`, `--accent`, `--accent-hover`, `--text`, `--text-sec`, `--border-c`, `--success`, `--error`, `--warning`)
   - `ThemeDefinition`: `{ id: string; name: string; emoji: string; accentHex: string; headerBg: string; vars: ThemeVars }`

2. **Helper functions** (copy from design system doc exactly):
   - `hexToHSL(hex: string): { h: number; s: number; l: number }` — parse hex to HSL
   - `hslToHex(h: number, s: number, l: number): string` — convert HSL back to hex
   - `clamp(value: number, min: number, max: number): number`

3. **`generateTheme(accentHex, name, id, emoji): ThemeDefinition`** — implements the exact derivation formulas from design system section 7:
   - `--accent` = input hex
   - `--accent-hover` = hsl(H, S, max(L-8, 20))
   - `--bg` = hsl(H, clamp(S*0.35, 20, 45), 6)
   - `--surface` = hsl(H, clamp(S*0.40, 20, 50), 14)
   - `--text` = #ffffff (invariant)
   - `--text-sec` = hsl(H, clamp(S*0.50, 25, 60), 80)
   - `--border-c` = hsl(H, clamp(S*0.35, 15, 40), 24)
   - `--success` = #10b981, `--error` = #ef4444, `--warning` = #f59e0b (invariants)
   - `headerBg`: generate the multi-layer gradient string per design system section 7 step 3

4. **WCAG contrast validation:**
   - `luminance(hex: string): number` — relative luminance
   - `contrastRatio(hex1: string, hex2: string): number`
   - `validateThemeContrast(vars: ThemeVars): { valid: boolean; issues: string[] }` — checks:
     - text (#fff) vs bg >= 4.5 (AA normal text)
     - text (#fff) vs surface >= 4.5
     - accent vs bg >= 3.0 (AA large text / UI elements)
     - text-sec vs surface >= 4.5

5. **Built-in palettes** — create using `generateTheme()`:
   - `techModern` = generateTheme("#00d9ff", "Tech Modern", "tech-modern", "")
   - `vibrantPurple` = generateTheme("#c084fc", "Vibrant Purple", "vibrant-purple", "")
   - `natureTeal` = generateTheme("#14b8a6", "Nature Teal", "nature-teal", "")
   - `energyOrange` = generateTheme("#f97316", "Energy Orange", "energy-orange", "")

6. **Exports:**
   - `BUILT_IN_THEMES: Record<string, ThemeDefinition>` — map of all 4
   - `DEFAULT_THEME_ID = "tech-modern"`
   - `generateTheme`, `validateThemeContrast`, types

Note: Do NOT use emoji characters in the theme definitions (per project convention). Use empty string for emoji field.
  </action>
  <verify>
Run `cd /workspace/frontend && npx tsc --noEmit` — no type errors. Manually verify the 4 built-in theme hex values approximate the design system values (exact match not required since generateTheme derives them).
  </verify>
  <done>themes.ts exports generateTheme, BUILT_IN_THEMES with 4 palettes, validateThemeContrast, and all types. Each built-in theme has 10 CSS variable tokens. Contrast validation passes for all 4 built-in themes.</done>
</task>

<task type="auto">
  <name>Task 2: ThemeProvider context, backend theme field, Inter font, CSS foundation</name>
  <files>
    frontend/src/contexts/ThemeContext.tsx
    frontend/src/index.css
    backend/src/collections/Events.ts
    frontend/src/lib/api.ts
  </files>
  <action>
**A. Install Inter font:**
```bash
cd /workspace/frontend && npm install @fontsource/inter
```

**B. Create ThemeProvider (`frontend/src/contexts/ThemeContext.tsx`):**

React context that:
- Accepts `themeId?: string` and `customAccent?: string` props
- Resolves theme: if `themeId` exists in BUILT_IN_THEMES, use it. If `customAccent` is provided, call `generateTheme(customAccent, "Custom", "custom", "")`. Fallback to DEFAULT_THEME_ID.
- Provides via context: `{ theme: ThemeDefinition; themeId: string }`
- Renders a wrapper `<div>` that:
  - Sets `style` attribute with all 10 CSS custom properties from `theme.vars` (e.g., `{ '--bg': theme.vars['--bg'], ... } as React.CSSProperties`)
  - Sets `className="min-h-screen"` and applies `font-family: 'Inter', system-ui, sans-serif` via style
  - Sets inline background-color to `var(--bg)` and color to `var(--text)` via style
- Exports `useTheme()` hook that returns context value

The ThemeProvider wraps ONLY the public pages (not the whole app). It will be consumed by SignPage and SuccessPage.

**C. Update `frontend/src/index.css`:**
- Add `@import '@fontsource/inter/400.css';` and `@import '@fontsource/inter/500.css';` and `@import '@fontsource/inter/600.css';` and `@import '@fontsource/inter/700.css';` at the top (before `@import "tailwindcss"`)
- Keep ALL existing :root and .dark CSS variables intact (they are used by organizer dashboard shadcn components)
- Do NOT remove or modify existing shadcn CSS variables

**D. Add theme field to backend Events collection (`backend/src/collections/Events.ts`):**

Add a new field in the "Informations generales" tab, after the `status` field:
```typescript
{
  name: 'theme',
  type: 'json',
  label: 'Theme',
  admin: {
    description: 'Theme configuration for public signing page',
  },
}
```
This stores either `{ themeId: "tech-modern" }` for built-in themes or `{ customAccent: "#e63946" }` for custom themes. Default is null (fallback to tech-modern on frontend).

**E. Update `frontend/src/lib/api.ts` — `fetchAttendanceDay`:**
The function already fetches the event object. The event's `theme` field will be included automatically in the response (it's a JSON field). No code change needed unless the depth parameter strips it — verify by checking that `day.event.theme` flows through. The existing code fetches `events/${eventId}?depth=0` which returns all scalar/json fields. No change needed.
  </action>
  <verify>
1. `cd /workspace/frontend && npx tsc --noEmit` — no type errors
2. `cd /workspace/backend && npx tsc --noEmit` — no type errors (or run `npm run build` if tsc alone fails)
3. Verify Inter font files exist: `ls /workspace/frontend/node_modules/@fontsource/inter/`
  </verify>
  <done>ThemeProvider wraps content with CSS custom properties from theme config. Inter font installed and imported. Events collection has theme JSON field. Public pages can be wrapped in ThemeProvider with event-specific theme data.</done>
</task>

</tasks>

<verification>
1. `frontend/src/config/themes.ts` exports generateTheme, BUILT_IN_THEMES (4 themes), validateThemeContrast
2. `frontend/src/contexts/ThemeContext.tsx` exports ThemeProvider and useTheme
3. `frontend/src/index.css` imports Inter font weights (400, 500, 600, 700)
4. `backend/src/collections/Events.ts` has theme JSON field
5. Both frontend and backend compile without errors
</verification>

<success_criteria>
- generateTheme("#00d9ff") produces a ThemeDefinition with 10 CSS tokens
- All 4 built-in themes pass WCAG AA contrast validation
- ThemeProvider component renders children wrapped in a div with CSS custom properties
- Events collection accepts theme JSON data
- Inter font is available in the frontend build
</success_criteria>

<output>
After completion, create `.planning/phases/07-ui-design-style-guide-application/07-01-SUMMARY.md`
</output>
