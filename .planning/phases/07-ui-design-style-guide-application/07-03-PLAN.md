---
phase: 07-ui-design-style-guide
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - frontend/src/components/ThemeSelector.tsx
  - frontend/src/pages/EventDetailPage.tsx
  - frontend/src/components/EventForm.tsx
  - frontend/src/lib/schemas.ts
  - frontend/src/hooks/use-events.ts
  - frontend/src/i18n/locales/fr/organizer.json
  - frontend/src/i18n/locales/en/organizer.json
autonomous: true

must_haves:
  truths:
    - "Organizer can select one of 4 built-in themes when creating an event"
    - "Organizer can enter a custom accent color hex when creating an event"
    - "Organizer can change theme on existing event detail page"
    - "Theme selection is persisted to backend Events.theme field"
    - "Default theme is Tech Modern when none selected"
  artifacts:
    - path: "frontend/src/components/ThemeSelector.tsx"
      provides: "Reusable theme picker with 4 palette swatches + custom color input"
      exports: ["ThemeSelector"]
    - path: "frontend/src/pages/EventDetailPage.tsx"
      provides: "Theme selector card on event detail page"
      contains: "ThemeSelector"
    - path: "frontend/src/components/EventForm.tsx"
      provides: "Theme selector integrated in event creation form"
      contains: "ThemeSelector"
    - path: "frontend/src/lib/schemas.ts"
      provides: "theme field in createEventSchema"
      contains: "theme"
  key_links:
    - from: "frontend/src/components/ThemeSelector.tsx"
      to: "frontend/src/config/themes.ts"
      via: "imports BUILT_IN_THEMES for palette display"
      pattern: "import.*BUILT_IN_THEMES.*from.*config/themes"
    - from: "frontend/src/components/EventForm.tsx"
      to: "backend Events.theme"
      via: "submits theme object in form data"
      pattern: "theme"
    - from: "frontend/src/pages/EventDetailPage.tsx"
      to: "backend Events.theme"
      via: "updateEvent with theme payload"
      pattern: "updateEvent.*theme"
---

<objective>
Organizer-facing theme selection: ThemeSelector component, integration in EventForm (creation) and EventDetailPage (editing), schema updates, and bilingual translations.

Purpose: Enable organizers to choose per-event themes that control how the public signing page looks. This is the counterpart to Plan 02's public page theming.
Output: Complete organizer workflow for theme selection on both new and existing events.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-ui-design-style-guide-application/07-01-SUMMARY.md
@.claude/documentation/design-sytem-description.md
@frontend/src/components/EventForm.tsx
@frontend/src/pages/EventDetailPage.tsx
@frontend/src/lib/schemas.ts
@frontend/src/hooks/use-events.ts
@frontend/src/i18n/locales/fr/organizer.json
@frontend/src/i18n/locales/en/organizer.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: ThemeSelector component with palette grid and custom color picker</name>
  <files>frontend/src/components/ThemeSelector.tsx</files>
  <action>
Create `frontend/src/components/ThemeSelector.tsx` — a reusable component for organizers to pick a theme.

**Props:**
```typescript
interface ThemeSelectorProps {
  value: { themeId?: string; customAccent?: string } | null
  onChange: (theme: { themeId?: string; customAccent?: string }) => void
}
```

**Layout:**
1. **Palette grid**: 4 built-in themes displayed as clickable cards in a 2x2 grid (`grid grid-cols-2 gap-3`):
   - Each card shows:
     - A color swatch strip (h-8 rounded-t-md) with the theme's accent color as background
     - Theme name below (text-sm font-medium) in a padded area (px-3 py-2)
     - Border: `2px solid transparent`, becomes accent-colored when selected
   - On click: `onChange({ themeId: theme.id })`
   - Selected state: ring-2 with accent color, slight scale-105 transform

2. **Custom color section** (below the grid):
   - Label: "Custom accent color" / "Couleur d'accent personnalisee" (via i18n)
   - A row with:
     - Native `<input type="color">` (w-10 h-10) for color picker
     - Text input (w-32) showing hex value, editable
   - On change: `onChange({ customAccent: hexValue })`
   - When custom is active (value has customAccent), deselect built-in palette cards
   - Small preview strip below showing derived bg/surface/accent/text-sec colors using generateTheme()

3. **Validation**: If custom accent fails contrast validation (via `validateThemeContrast`), show a warning message in `var(--warning)` color: "This color may not meet accessibility contrast requirements" / "Cette couleur pourrait ne pas respecter les exigences de contraste"

4. **Default state**: If `value` is null, highlight Tech Modern as the default (but don't call onChange — let it remain null = server default)

Import `BUILT_IN_THEMES`, `generateTheme`, `validateThemeContrast` from `@/config/themes`.
Import `useTranslation` from `react-i18next` with namespace `organizer`.
  </action>
  <verify>`cd /workspace/frontend && npx tsc --noEmit` passes.</verify>
  <done>ThemeSelector displays 4 built-in palettes as clickable cards with accent color swatches, plus custom color picker with hex input and contrast validation warning.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ThemeSelector in EventForm, EventDetailPage, schema, and translations</name>
  <files>
    frontend/src/components/EventForm.tsx
    frontend/src/pages/EventDetailPage.tsx
    frontend/src/lib/schemas.ts
    frontend/src/hooks/use-events.ts
    frontend/src/i18n/locales/fr/organizer.json
    frontend/src/i18n/locales/en/organizer.json
  </files>
  <action>
**A. Update `frontend/src/lib/schemas.ts`:**

Add `theme` field to `createEventSchema()`:
```typescript
theme: z.object({
  themeId: z.string().optional(),
  customAccent: z.string().regex(/^#[0-9a-fA-F]{6}$/).optional(),
}).nullable().optional(),
```
Update `EventFormData` type accordingly (it's inferred from the schema, so no manual change needed).

**B. Update `frontend/src/components/EventForm.tsx`:**

1. Import `ThemeSelector` from `@/components/ThemeSelector`
2. Add `theme` to defaultValues: `theme: null`
3. Add a section AFTER the CNOV field and BEFORE the DateSelector:
   ```
   <div className="space-y-2">
     <Label>{t('eventForm.theme')}</Label>
     <Controller
       name="theme"
       control={control}
       render={({ field }) => (
         <ThemeSelector
           value={field.value}
           onChange={field.onChange}
         />
       )}
     />
   </div>
   ```
4. The form submission already spreads all fields — theme will be included in the payload automatically.

**C. Update `frontend/src/pages/EventDetailPage.tsx`:**

1. Import `ThemeSelector` from `@/components/ThemeSelector`
2. Add theme state management (similar to CNOV inline edit pattern):
   - State: `const [editingTheme, setEditingTheme] = useState(false)`
   - State: `const [themeValue, setThemeValue] = useState(event?.theme || null)` — sync via useEffect like cnovValue
3. Add a new Card section AFTER the status controls card and BEFORE the QR codes card:
   ```
   <Card>
     <CardHeader>
       <CardTitle className="flex items-center justify-between">
         <span>{t('organizer:eventDetail.themeTitle')}</span>
         {!isLocked && !editingTheme && (
           <Button variant="outline" size="sm" onClick={() => setEditingTheme(true)}>
             <Pencil className="mr-1 h-3 w-3" />
             {t('organizer:eventDetail.editTheme')}
           </Button>
         )}
       </CardTitle>
     </CardHeader>
     <CardContent>
       {editingTheme ? (
         <div className="space-y-4">
           <ThemeSelector value={themeValue} onChange={setThemeValue} />
           <div className="flex gap-2">
             <Button size="sm" onClick={handleSaveTheme}>
               {t('organizer:eventDetail.saveTheme')}
             </Button>
             <Button size="sm" variant="outline" onClick={handleCancelTheme}>
               {t('organizer:eventDetail.cancelTheme')}
             </Button>
           </div>
         </div>
       ) : (
         <p className="text-sm text-neutral-600">
           {currentThemeLabel} {/* Display name of selected theme */}
         </p>
       )}
     </CardContent>
   </Card>
   ```
4. Add handlers:
   - `handleSaveTheme`: `updateEvent({ theme: themeValue })` then `setEditingTheme(false)`
   - `handleCancelTheme`: reset themeValue from event, close edit
5. Derive `currentThemeLabel`: look up `event.theme?.themeId` in BUILT_IN_THEMES to get name, or show "Custom: #xxx" if customAccent, or "Tech Modern (default)" if null.

**D. Update `frontend/src/hooks/use-events.ts`:**

Check that the `useUpdateEvent` mutation properly passes arbitrary fields to the PATCH endpoint. It likely already does (it sends the entire data object). Verify and ensure `theme` (as a JSON object) is included in the PATCH body. If the hook type-restricts the update payload, extend it to include `theme?: { themeId?: string; customAccent?: string } | null`.

**E. Update i18n translation files:**

Add to `frontend/src/i18n/locales/fr/organizer.json`:
```json
"eventForm": {
  ... (existing keys),
  "theme": "Theme de la page publique",
  "themePlaceholder": "Selectionnez un theme"
},
"eventDetail": {
  ... (existing keys),
  "themeTitle": "Theme de la page publique",
  "editTheme": "Modifier",
  "saveTheme": "Enregistrer",
  "cancelTheme": "Annuler",
  "defaultTheme": "Tech Modern (par defaut)",
  "customTheme": "Personnalise"
},
"theme": {
  "customAccent": "Couleur d'accent personnalisee",
  "contrastWarning": "Cette couleur pourrait ne pas respecter les exigences de contraste d'accessibilite"
}
```

Add to `frontend/src/i18n/locales/en/organizer.json`:
```json
"eventForm": {
  ... (existing keys),
  "theme": "Public page theme",
  "themePlaceholder": "Select a theme"
},
"eventDetail": {
  ... (existing keys),
  "themeTitle": "Public page theme",
  "editTheme": "Edit",
  "saveTheme": "Save",
  "cancelTheme": "Cancel",
  "defaultTheme": "Tech Modern (default)",
  "customTheme": "Custom"
},
"theme": {
  "customAccent": "Custom accent color",
  "contrastWarning": "This color may not meet accessibility contrast requirements"
}
```

IMPORTANT: When updating JSON files, READ the existing content first and ADD the new keys. Do NOT replace existing keys.
  </action>
  <verify>
1. `cd /workspace/frontend && npx tsc --noEmit` — no type errors
2. Verify schema includes theme: `grep -n "theme" frontend/src/lib/schemas.ts`
3. Verify ThemeSelector is imported in both EventForm and EventDetailPage
4. Verify translations: `node -e "const fr = require('./frontend/src/i18n/locales/fr/organizer.json'); console.log(fr.theme?.customAccent);"` outputs the French string
  </verify>
  <done>
Organizers can:
- Select a built-in theme (4 options) or custom accent color when creating an event via EventForm
- View and change the theme on existing events via EventDetailPage
- Theme selection is saved as JSON to Events.theme field
- All UI text is bilingual (FR/EN)
- Contrast validation warns about inaccessible custom colors
  </done>
</task>

</tasks>

<verification>
1. ThemeSelector renders 4 palette cards and a custom color input
2. EventForm includes ThemeSelector controlled via react-hook-form Controller
3. EventDetailPage shows theme card with edit functionality
4. createEventSchema accepts theme field
5. Both FR and EN translations include all theme-related keys
6. All files compile without TypeScript errors
</verification>

<success_criteria>
- Organizer sees ThemeSelector with 4 color palette cards + custom accent picker on event creation form
- Organizer can edit theme on existing event detail page
- Theme data (themeId or customAccent) is saved to backend via PATCH/POST
- Default when no theme selected is Tech Modern
- Contrast warning appears for poor custom accent choices
</success_criteria>

<output>
After completion, create `.planning/phases/07-ui-design-style-guide-application/07-03-SUMMARY.md`
</output>
