---
phase: 05-platform-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/i18n/index.ts
  - frontend/src/i18n/locales/en/common.json
  - frontend/src/i18n/locales/en/public.json
  - frontend/src/i18n/locales/en/organizer.json
  - frontend/src/i18n/locales/fr/common.json
  - frontend/src/i18n/locales/fr/public.json
  - frontend/src/i18n/locales/fr/organizer.json
  - frontend/src/@types/i18next.d.ts
  - frontend/src/components/LanguageSwitcher.tsx
  - frontend/src/main.tsx
  - frontend/src/components/OrganizerLayout.tsx
  - frontend/src/pages/SignPage.tsx
autonomous: true

must_haves:
  truths:
    - "i18next is initialized with FR/EN resources and localStorage persistence"
    - "LanguageSwitcher component toggles between FR and EN"
    - "Language preference persists across page reload via localStorage"
    - "Translation files contain all UI strings organized by namespace"
  artifacts:
    - path: "frontend/src/i18n/index.ts"
      provides: "i18next configuration with LanguageDetector, fallbackLng fr, 3 namespaces"
      contains: "initReactI18next"
    - path: "frontend/src/i18n/locales/fr/common.json"
      provides: "French common translations (buttons, labels, errors)"
    - path: "frontend/src/i18n/locales/en/common.json"
      provides: "English common translations"
    - path: "frontend/src/i18n/locales/fr/public.json"
      provides: "French public signing flow translations"
    - path: "frontend/src/i18n/locales/en/public.json"
      provides: "English public signing flow translations"
    - path: "frontend/src/i18n/locales/fr/organizer.json"
      provides: "French organizer dashboard translations"
    - path: "frontend/src/i18n/locales/en/organizer.json"
      provides: "English organizer dashboard translations"
    - path: "frontend/src/components/LanguageSwitcher.tsx"
      provides: "FR/EN toggle button with Languages icon"
      contains: "changeLanguage"
  key_links:
    - from: "frontend/src/main.tsx"
      to: "frontend/src/i18n/index.ts"
      via: "import './i18n' before App"
      pattern: "import.*i18n"
    - from: "frontend/src/components/OrganizerLayout.tsx"
      to: "frontend/src/components/LanguageSwitcher.tsx"
      via: "LanguageSwitcher in header"
      pattern: "LanguageSwitcher"
---

<objective>
Set up the i18n infrastructure: install react-i18next ecosystem, create translation JSON files for all 3 namespaces (common, public, organizer) in both FR and EN, create the LanguageSwitcher component, and wire everything into the app entry point.

Purpose: Foundation for bilingual UI — all subsequent string replacement depends on this infrastructure being in place.
Output: Working i18n system with complete translation files, LanguageSwitcher in OrganizerLayout header and on public SignPage.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-platform-polish/05-RESEARCH.md
@frontend/src/main.tsx
@frontend/src/components/OrganizerLayout.tsx
@frontend/src/lib/schemas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install i18n dependencies and create translation infrastructure</name>
  <files>
    frontend/src/i18n/index.ts
    frontend/src/i18n/locales/en/common.json
    frontend/src/i18n/locales/en/public.json
    frontend/src/i18n/locales/en/organizer.json
    frontend/src/i18n/locales/fr/common.json
    frontend/src/i18n/locales/fr/public.json
    frontend/src/i18n/locales/fr/organizer.json
    frontend/src/@types/i18next.d.ts
    frontend/src/main.tsx
  </files>
  <action>
1. Install i18n packages:
   ```bash
   cd /workspace/frontend && npm install i18next react-i18next i18next-browser-languagedetector
   ```

2. Create `frontend/src/i18n/index.ts` — i18next initialization with:
   - LanguageDetector plugin (localStorage first, then navigator)
   - initReactI18next plugin
   - Resources object importing all 6 JSON files (3 namespaces x 2 languages)
   - fallbackLng: 'fr' (French default per project requirement)
   - defaultNS: 'common'
   - detection: { order: ['localStorage', 'navigator'], caches: ['localStorage'], lookupLocalStorage: 'i18nextLng' }
   - interpolation: { escapeValue: false } (React handles escaping)

3. Create all 6 translation JSON files by auditing EVERY component in the codebase and extracting ALL hardcoded French strings. Organize into namespaces:

   **common.json** — Shared UI elements used across both public and organizer:
   - Loading states: "Chargement...", "Recherche..."
   - Actions: "Enregistrer", "Annuler", "Supprimer", "Confirmer", "Retour", "Ajouter", "Voir"
   - Errors: "Erreur", "Erreur inconnue", "Erreur de connexion, veuillez réessayer"
   - Form labels: "Nom", "Prénom", "Email", "Ville"
   - Status labels: "Brouillon", "Ouvert", "Finalisé"
   - Beneficiary types: "ASV", "Autre", "Éleveur", "Étudiant", "Pharmacien", "Technicien", "Vétérinaire"
   - Validation messages from schemas.ts: "Le nom est requis", "Le prénom est requis", "Email invalide", "La ville est requise", "Le type de bénéficiaire est requis", "Veuillez préciser le type de bénéficiaire"
   - Plurals: "{{count}} participant", "{{count}} participants" (use _one/_other suffix for v23+)
   - Day count: "{{count}} jours"

   **public.json** — Public signing flow (SignPage, ParticipantForm, SignatureCanvas, SuccessPage):
   - "Signez ici", "Effacer"
   - "Feuille de présence"
   - "Numéro d'inscription professionnelle", "Si applicable (vétérinaires, pharmaciens)"
   - "Type de bénéficiaire", "Sélectionner..."
   - "Préciser le type"
   - "Signature"
   - "J'autorise l'utilisation de photos prises lors de l'événement"
   - "La signature est requise", "Erreur lors de la capture de la signature"
   - "Envoi en cours...", "Signer"
   - "Aucune session configurée pour cette journée"
   - "Veuillez sélectionner une session", "Sélectionnez la session"
   - "Cet evenement est finalise. Les signatures ne sont plus acceptees."
   - "Cet evenement n'est pas encore ouvert aux signatures."
   - Success page: "Merci {{name}} !", "Signature enregistrée !", "Votre signature a été enregistrée avec succès."
   - "Droit à l'image" consent label

   **organizer.json** — Organizer dashboard (LoginPage, DashboardPage, EventCreatePage, EventForm, EventDetailPage, ParticipantSearch, ParticipantTable, AttendanceDashboard, DateSelector):
   - Login: "Connectez-vous pour gérer vos événements", "Connexion", "Entrez vos identifiants pour accéder à votre espace organisateur", "Mot de passe", "Email ou mot de passe incorrect", "Se connecter", "Connexion..."
   - Navigation: "Événements", "Nouvel événement", "Déconnexion"
   - Dashboard: "Mes evenements", "Nouvel evenement", "Aucun evenement", "Creez votre premier evenement"
   - Table headers: "Titre", "Lieu", "Dates", "Type de depense", "Statut", "Actions"
   - Expense types: "Hospitalite - Collation", "Hospitalite - Restauration", "Hospitalite - Hebergement", "Frais d'inscription evenement", "Frais de reunion/organisation", "Frais de transport"
   - Event form: "Titre de l'evenement", "Lieu", "Nom de l'organisateur", "Email de l'organisateur", "Type de depense", "Selectionnez un type de depense", "Dates de l'evenement", "Creation en cours...", "Creer l'evenement"
   - Event detail: "Retour au tableau de bord", "Événement introuvable", "Organisateur:", "Dates:", "Statut de l'événement", "Ouvrir l'événement", "Finaliser l'événement", "Événement finalisé", "Finaliser cet événement ? Cette action est définitive.", "Génération...", "Télécharger XLSX", "Échec du téléchargement, veuillez réessayer"
   - QR codes: "QR Codes pour signature", "Scannez ce code pour accéder à la page de signature"
   - Participants: "Participants", "Rechercher dans le registre SIMV", "Rechercher dans le registre SIMV...", "Nom ou numéro d'inscription...", "Sans numéro", "Aucun résultat", "Ajouter un participant sans inscription", "N° d'inscription", "Aucun participant pré-inscrit", "Retirer ce participant de la liste ?"
   - Walk-in: "Numéro d'inscription", "Type de bénéficiaire", "Sélectionner un type"
   - Attendance: "Présence en direct", "Chargement de la présence...", "Aucune journée de présence", "Mise à jour automatique", "présents" (as in "X / Y présents"), "Signé", "Aucune signature pour le moment", "Ouvrez l'événement pour voir la présence en direct"
   - Date selector: "Cliquez sur le calendrier pour selectionner des dates", "Dates selectionnees :"
   - Event create: "Erreur lors de la creation de l'evenement. Veuillez reessayer."
   - Validation: "Le titre est requis", "Le titre est trop long", "Le lieu est requis", "Le nom de l'organisateur est requis", "Le type de depense est requis", "Au moins une date est requise"

   For each French key, provide the corresponding English translation. Use flat keys with camelCase (e.g., "signHere", "attendanceSheet", "beneficiaryTypes.veterinaire"). For nested objects, use dot notation in key names or nested JSON objects — prefer nested JSON for groupings like beneficiaryTypes, expenseTypes, statuses, validation messages.

4. Create `frontend/src/@types/i18next.d.ts` — TypeScript module augmentation:
   - Import common, public, organizer JSON from en locale
   - Declare module 'i18next' with CustomTypeOptions for type-safe t() calls

5. Update `frontend/src/main.tsx` — Add `import './i18n'` BEFORE the App import so i18n initializes before any component renders.
  </action>
  <verify>
    - `cd /workspace/frontend && npx tsc --noEmit` passes without errors
    - All 6 JSON files exist and have matching key structures between FR and EN
    - `grep -r "import.*i18n" frontend/src/main.tsx` shows i18n import before App
  </verify>
  <done>
    i18next initialized with 3 namespaces x 2 languages, TypeScript types declared, i18n imported before App in main.tsx, all translation keys covering every hardcoded string in the codebase are present in both FR and EN JSON files
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LanguageSwitcher and add to layouts</name>
  <files>
    frontend/src/components/LanguageSwitcher.tsx
    frontend/src/components/OrganizerLayout.tsx
    frontend/src/pages/SignPage.tsx
  </files>
  <action>
1. Create `frontend/src/components/LanguageSwitcher.tsx`:
   - Import useTranslation from react-i18next
   - Import Button from @/components/ui/button
   - Import Languages icon from lucide-react
   - Toggle function: `i18n.language === 'fr' ? 'en' : 'fr'` → `i18n.changeLanguage(newLang)` (auto-saves to localStorage)
   - Render: Button variant="outline" size="sm" with Languages icon + text showing opposite language ("EN" when French, "FR" when English)
   - Add aria-label for accessibility

2. Update `frontend/src/components/OrganizerLayout.tsx`:
   - Import LanguageSwitcher
   - Add `<LanguageSwitcher />` in the header, between the user name and the Déconnexion button

3. Update `frontend/src/pages/SignPage.tsx`:
   - Import LanguageSwitcher
   - Add LanguageSwitcher in the top-right corner of the page (absolute or flex positioned), so public participants can also switch language. Place it inside the max-w-lg container, right-aligned above the event title.
  </action>
  <verify>
    - `cd /workspace/frontend && npx tsc --noEmit` passes
    - `grep -r "LanguageSwitcher" frontend/src/` shows imports in OrganizerLayout.tsx and SignPage.tsx
  </verify>
  <done>
    LanguageSwitcher component exists, is rendered in OrganizerLayout header and on public SignPage, toggles i18n language and displays current state
  </done>
</task>

</tasks>

<verification>
1. `cd /workspace/frontend && npx tsc --noEmit` — no TypeScript errors
2. All translation JSON files exist with complete FR and EN coverage
3. LanguageSwitcher is wired into both organizer and public layouts
4. i18n is imported before App in main.tsx
</verification>

<success_criteria>
- i18next fully configured with 3 namespaces, 2 languages, localStorage persistence
- Translation files contain ALL hardcoded strings from every component (comprehensive audit)
- LanguageSwitcher toggles language and persists choice
- TypeScript types are set up for type-safe translations
- Build compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-platform-polish/05-01-SUMMARY.md`
</output>
